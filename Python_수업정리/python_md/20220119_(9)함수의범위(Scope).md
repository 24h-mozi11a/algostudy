## 함수의 범위 (Scope)



### 추상화

![image-20220130212346065](20220119_(9)함수의범위(Scope).assets/image-20220130212346065.png)



### 함수의 범위 

- 함수는 코드 내부에 local scope를 생성하며, 그 외의 공간인 global scope로 구분 
- scope
  - global scope : 코드 어디에서든 참조할 수 있는 공간 
  - local scope : 함수가 만든 scope. 함수 내부에서만 참조 가능 
- variable
  - global variable : global scope에 정의된 변수 
  - local variable : local scope에 정의된 변수

``` python
def ham():
    a = 'spam'
    return a

# 1.
print(a) # NameError: name 'a' is not defined

# 2.
ham() 
print(a) # NameError: name 'a' is not defined

# 함수는 가장 기본 : local scope!
# 블랙박스의 결과를 받아보고 싶으면 반환 값을 변수에 저장해서 사용하는 것!
# 블랙박스 밖으로 결과를 주고 싶을 수 있어요! => return 해야해요
```

-----



### 변수 수명주기(lifecycle)

- 변수는 각자의 수명주기(lifecycle)가 존재 

  - built-in scope
    - 파이썬이 실행된 이후부터 영원히 유지 

  - global scope 
    - 모듈이 호출된 시점 이후 혹은 인터프리터가 끝날 때 까지 유지 

  - local scope
    - 함수가 호출될 때 생성되고, 함수가 종료될 때 까지 유지

![image-20220130213432985](20220119_(9)함수의범위(Scope).assets/image-20220130213432985.png)

----



### 이름 검색 규칙(Name Resolution)

- 파이썬에서 사용되는 이름(식별자)들은 이름공간(namespace)에 저장되어 있음.
- 아래와 같은 순서로 이름을 찾아나가며, LEGB Rule이라고 부름 
  - Local scope : 함수
  - Enclosed scope : 특정 함수의 상위 함수 
  - Global scope : 함수 밖의 변수, Import 모듈 
  - Built-in scope : 파이썬 안에 내장되어 있는 함수 또는 속성 

- 즉, 함수 내에서는 바깥 Scope 변수에 접근 가능하나 수정은 할 수 없음.

![image-20220130213744774](20220119_(9)함수의범위(Scope).assets/image-20220130213744774.png)

``` python
a = 0 
b = 1
def enclosed():
    a = 10 
    c = 3
    def local(c):
        print(a, b, c) #10 1 300
        local(300)
        print(a, b, c) #10 1 3
enclosed()
print(a, b) #0 1
```

``` python
print(sum) #<built-in function sum>
print(sum(range(2))) #1
sum = 5 #global scope 이름공간의 sum 변수에 값 5가 할당
print(sum) #5
print(sum(range(2))) #TypeError: 'int' object is not callable

#이후 global scope에서 sum은 LEGB에 의해 Built-in scope의 내장함수 보다 우선한다. 
```



### global문 

- 현재 코드 블록 전체에 적용되며, 나열된 식별자(이름)이 global variable임을 나타냄 
  - global에 나열된 이름은 같은 코드 블록에서 global 앞에 등장할 수 없음
  - global에 나열된 이름은 parameter, for 루프 대상, 클래스/함수 정의 등으로 정의되지 않아야 함

``` python
#함수 내부에서 글로벌 변수 변경하기 
a = 10 
def func1():
    global a # 항상 상단에 써야 오류 안남
    a = 3
    
print(a) #10
func1() 함수 호출하고 부터 global a가 바뀜
print(a) #3
```



### nonlocal 

- global을 제외하고 가장 가까운(둘러 싸고 있는) scope 변수를 연결하도록 함 
  - nonlocal에 나열된 이름은 같은 코드 블록에서 nonlocal 앞에 등장할 수 없음.
  - nonlocal에 나열된 이름은 parameter, for 루프 대상, 클래스/함수 정의 등으로 정의되지 않아야 함 

- global 과는 달리 이미 존재하는 이름과의 연결만 가능함

``` python
#nonlocal 예시 

x = 0 
def func1():
    x = 1
    def func2():
        nonlocal x
        x = 2
    func2()
    print(x) #2

func1()
print(x) #0

#enclosed scope(func1)의 변수 x의 변경
#nonlocal은 이름공간 상에 존재하는 변수만 가능
```

---



### 주의 

- 기본적으로 함수에서 선언된 변수는 Local scope에 생성되며, 함수 종료 시 사라짐 
- 해당 scope에 변수가 없는 경우 LEGB rule에 의해 이름을 검색함
  - 변수에 접근은 가능하지만, 해당 변수를 수정할 수는 없음
  - 값을 할당하는 경우 해당 scope의 이름공간에 새롭게 생성되기 때문
  - 단, 함수 내에서 필요한 상위 scope 변수는 argument로 넘겨서 활용할 것(클로저* 제외)
    - 클로저란 : 어떤 함수 내부에서 중첩된 형태로써 외부 scope변수에 접근 가능한 함수 

- 상위 scope에 있는 변수를 수정하고 싶다면 global, nonlocal 키워드를 활용 가능 
  - 단, 코드가 복잡해지면서 변수의 변경을 추적하기 어렵고, 예기치 못한 오류가 발생 
  - 가급적 사용하지 않는 것을 권장하며, 함수로 값을 바꾸고자 한다면 항상 argument로 넘기고 리턴 값을 사용 하는 것을 추천